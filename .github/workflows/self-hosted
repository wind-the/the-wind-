name: Deploy Static Content to Pages

on:
  push:
    branches: ["main"] # åœ¨ä¸»åˆ†æ”¯æ¨é€æ—¶è§¦å‘

jobs:
  # ç¡®ä¿è¿™ä¸ª job è¿è¡Œåœ¨æ‚¨çš„è‡ªæ‰˜ç®¡è¿è¡Œå™¨ä¸Š
  deploy:
    runs-on: self-hosted  # ğŸ‘ˆ å¿…é¡»ä½¿ç”¨æ‚¨çš„è‡ªæ‰˜ç®¡è¿è¡Œå™¨æ ‡ç­¾
    
    # å°† Pages éƒ¨ç½²æƒé™æˆäºˆ GITHUB_TOKEN
    permissions:
      pages: write      # å†™å…¥ pages artifact
      id-token: write   # OIDC è®¤è¯

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # å‡è®¾æ‚¨çš„é™æ€å†…å®¹æ„å»ºå‘½ä»¤æ˜¯ npm run build
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: Build static site
        run: |
          npm install
          npm run build # ğŸ‘ˆ è¿è¡Œæ‚¨çš„æ„å»ºå‘½ä»¤

      - name: Setup Pages
        uses: actions/configure-pages@v5 # é…ç½® Pages ç¯å¢ƒ

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './_site' # ğŸ‘ˆ æ›¿æ¢ä¸ºæ‚¨çš„æ„å»ºè¾“å‡ºç›®å½• (ä¾‹å¦‚ dist, build)

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4 # ğŸ‘ˆ éƒ¨ç½² artifact
